<!doctype html>
<html lang="us">
<head>
	<meta charset="utf-8">
	<title>First jQuery UI</title>
	<link href="css/smoothness/jquery-ui-1.10.3.custom.css" rel="stylesheet">
	<script src="js/jquery-1.9.1.js"></script>
	<script src="js/jquery-ui-1.10.3.custom.js"></script>
	<script>
		$(function() {			
		    $( "#tabs" ).tabs();
    	});
	</script>

	<style type=text/css>
		li.ui-state-default {
    		font-size : 10px;
  		}
  		div.ui-tabs-panel {
    		font-size : 10px;
    		font-family : georgia;
    		font-style : italic;
  		}
  	</style>

	<script>
  
  		$(document).ready(function(){
			console.log('in ready ... ');
			
			var previousclass;

			init();
						
			getCheckInClassList();
			
			$("#checkinClassCombobox").focus(function() {
				previousclass = this.value;
			}).change(function() {
				if (this.value != "" ) {
					document.getElementById("btnStudentCheckInSearch").disabled = false;
					document.getElementById("btnNonClassStudentCheckInSearch").disabled = false;
					if (this.value != previousclass) {
						var tempdiv = document.getElementById("tempdiv");
						if ( null != tempdiv ) {
							tempdiv.remove();
						}

						var nonclassstudentdiv = document.getElementById("nonclassstudentdiv");
						if (null != nonclassstudentdiv) {
							nonclassstudentdiv.remove();
						}
					}
				} else {
					document.getElementById("btnStudentCheckInSearch").disabled = true;
					var tempdiv = document.getElementById("tempdiv");
					if ( null != tempdiv ) {
						tempdiv.remove();
					}
					
					document.getElementById("btnNonClassStudentCheckInSearch").disabled = true;
					var nonclassstudentdiv = document.getElementById("nonclassstudentdiv");
					if (null != nonclassstudentdiv) {
						nonclassstudentdiv.remove();
					}
					
				}
			});

			$("#btnStudentCheckInSearch").click(function() {
				console.log(" search student for check in process .. ");
				var checkinclasses = document.getElementById("checkinClassCombobox");
				if (null == checkinclasses.value || checkinclasses.value.length == 0) {
					alert("please select one class from the list");
				} else {
					getStudentCheckInDtoList(checkinclasses.value);
				}
			});
			
			$("#btnNonClassStudentCheckInSearch").click(function() {
				console.log(" search non class student for check in process .. ");
				var fname = document.getElementById("fname").value;
				var lname = document.getElementById("lname").value;
				if ((null == fname || fname.length == 0) ||
				    (null == lname || lname.length == 0)) {
				    alert("please input both last name and first name");
				} else {
					var checkinclasses = document.getElementById("checkinClassCombobox");
					getNonClassStudentCheckInDto(lname, fname, checkinclasses.value);
				}
			});
			
			$(document).on('click', '#tempdiv :button', function() {
				console.log(" click new button ... " + this.id);
				var checkinclasses = document.getElementById("checkinClassCombobox");
				checkInStudent(this.id, checkinclasses.value);
			});

		});
		
		function getNonClassStudentCheckInDto(lname, fname, cid) {
			console.log(' get non class checkin  student ... ');
			
			$.ajax({
				type: "GET",
				dataType: "json",
				url: "../msd-app/msdstudentcheckin",
				data: { msdclassid:cid, firstname: fname, lastname: lname, type: 'checkin' },
				success: function(data) {
					console.log(" get non class student for check in ");
					var nonclassstudentdiv = document.getElementById("nonclassstudentdiv");
					if (null != nonclassstudentdiv) {
						nonclassstudentdiv.remove();
					}
					
					nonclassstudentdiv = $("<div id=nonclassstudentdiv> </div>");
					$("#addNonClassStudentCheckinButton_here").after(nonclassstudentdiv);
					var newbutton = $('<input/>').attr({ type: 'button', id:'btnnonclasssnew_' + data.studentId, value:data.name});
					if (data.checkedIn) {
						newbutton.prop("disabled", true);
					}
					$("#nonclassstudentdiv").append(newbutton);
				},
				error: function(msg, url, line) {
					alert('error to get non class student for check in ... ');
				}
			});
		};
		
		function checkInStudent(btnid, cid) {
			var sid = btnid.substring(7);
			var checkintime = new Date();

			var scheckin = { "checkInTime":checkintime, "classId":cid, "id":0, "studentId":sid };
			
			$.ajax({
				type: "POST",
				url: "../msd-app/msdstudentcheckin",
				dataType: "json",
				data: JSON.stringify(scheckin),
				contentType: "application/json",
				processData:false,
				success: function(data) {
					var btn = document.getElementById(btnid);
					if (null != btn) {
						btn.disabled = true;
					}
				},
				error: function(msg, url, line) {
					alert('error');
				}
			});
		};

		function getStudentCheckInDtoList(classid) {
			console.log("in getStudentCheckInDtoList ... ");
						
			$.ajax({
				type: "GET",
				dataType: "json",
				url: "../msd-app/msdstudentcheckin",
				data: { msdclassid: classid, type: 'checkin' },
				success: function(data) {
					var tempdiv = document.getElementById("tempdiv");
					if ( null != tempdiv ) {
						tempdiv.remove();
					}

					tempdiv = $("<div id=tempdiv> </div>");
					$("#addStudentCheckinButton_here").after(tempdiv);

					$.each(data, function (i, theItem) {
						var newbutton = $('<input/>').attr({ type: 'button', id:'btnnew_' + theItem.studentId, value:theItem.name});
						if (theItem.checkedIn) {
							newbutton.prop("disabled", true);
						}
						$("#tempdiv").append(newbutton);
					});
				},
				error: function(msg, url, line) {
					alert('error');
				}
			});
		};

		function getCheckInClassList() {
			console.log('in getCheckInClassList ... ');
			$.ajax({
				type: "GET",
				url: "../msd-app/msdclass",
				dataType: "json",
				contentType: "application/json",
				success: function(data) {
					$.each(data, function (i, theItem) {
						var checkinclasses = document.getElementById("checkinClassCombobox");
						var option = document.createElement("option");
						option.text = theItem.name;
						option.value = theItem.id;
						checkinclasses.add(option, null);
					});
				},
				error: function(msg, url, line) {
					alert('error');
				}
			});
		};
		
		function init() {
			var checkinclasses = document.getElementById("checkinClassCombobox");
			if (null == checkinclasses.value || checkinclasses.value.length == 0) {
				document.getElementById("btnStudentCheckInSearch").disabled = true;
				document.getElementById("btnNonClassStudentCheckInSearch").disabled = true;
			}			
		};
  	</script>
</head>
<body>

	<p align="center"><img align="middle" src="msd.jpg" alt="some_text"></p>

	<div id="tabs">
	<ul>
    	<li><a href="#tabs-Student">Student</a></li>
	    <li><a href="#tabs-Class">Class</a></li>
	    <li><a href="#tabs-CheckIn">Student CheckIn</a></li>
	</ul>
  	<div id="tabs-Student">
    	<h2>MSD Student function ... </h2>
		<div class="ui-widget">
			<h3> Under construct ... </h3>
		</div>  
	</div>
  	<div id="tabs-Class">
    	<h2>MSD Class function ... </h2>
		<div class="ui-widget">
			<h3> Under construct ... </h3>
		</div>  
  	</div>
  	<div id="tabs-CheckIn">
    	<h2>Student Class Check In</h2>
    	<div class="ui-widget">
  			
  			<label>Please select class:</label>
  			<select id="checkinClassCombobox">
    			<option value="">Select one...</option>
  			</select>
  			<input id="btnStudentCheckInSearch" type="button" value="search" />
  			<div id="addStudentCheckinButton_here"></div>
  			
  			<label>If student not register to above class, or this is a makeup class please input student name to check in.</label>
  			<br/>
  			<label>last name : </label>
  			<input type="text" id="lname" />
  			<label>first name : </label>
  			<input type="text" id="fname" />
  			<input id="btnNonClassStudentCheckInSearch" type="button" value="search" />
  			<div id="addNonClassStudentCheckinButton_here"></div>
  		</div>
  	</div>
	</div>

</body>
</html>
